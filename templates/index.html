<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converse com Marcelicks</title>
    <style>
        /* Estilo para deixar a página bonita */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f0f2f5; }
        .chat-container { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); width: 90%; max-width: 500px; text-align: center; }
        h1 { color: #1c1e21; }
        input { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background-color: #0866ff; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: background-color 0.3s; }
        button:disabled { background-color: #a0a0a0; }
        #response { margin-top: 20px; text-align: left; background-color: #e7f3ff; padding: 15px; border-radius: 8px; display: none; }
    </style>
</head>
<body>

    <div class="chat-container">
        <h1>Converse com Marcelicks</h1>
        <p>(Se tiver coragem)</p>
        <input type="text" id="userInput" placeholder="Digite sua pergunta inútil aqui...">
        <button id="sendButton" onclick="getChatResponse()">Enviar para o Mestre</button>
        <div id="response"></div>
    </div>

    <script>
        // --- CONFIGURAÇÃO IMPORTANTE ---
        const MARCELICKS_BRAIN_URL = 'https://chatbot-backend-marcelicks.onrender.com/webhook';
        
        // ##################################################################
        // #                                                                #
        // # ==>   COLE SUA CHAVE DA ELEVENLABS DENTRO DAS ASPAS AQUI   <==   #
        // #                                                                #
        // ##################################################################
        const ELEVENLABS_API_KEY = 'sk_c4ad606b09670023b115e27453732eb0ac4be7c88b34cd5e';
        
        // Esta é a ID da SUA VOZ personalizada.
        const VOICE_ID = 'Q6KIuDWIIqpbbWefMg8U'; 
        // --- FIM DA CONFIGURAÇÃO ---


        async function getChatResponse() {
            const userInput = document.getElementById('userInput').value;
            const sendButton = document.getElementById('sendButton');
            const responseDiv = document.getElementById('response');

            if (!userInput) {
                alert("Você precisa perguntar alguma coisa, gênio.");
                return;
            }

            sendButton.disabled = true;
            sendButton.innerText = 'O Mestre está pensando...';
            responseDiv.style.display = 'none';

            try {
                const textResponse = await fetch(MARCELICKS_BRAIN_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userInput })
                });

                if (!textResponse.ok) {
                    // Se o erro vier do nosso servidor (Ex: Internal Server Error)
                    const errorData = await textResponse.json();
                }

                const data = await textResponse.json();
                const marcelicksText = data.text_response;

                responseDiv.innerText = marcelicksText;
                responseDiv.style.display = 'block';

                const audioResponse = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': ELEVENLABS_API_KEY
                    },
                    body: JSON.stringify({
                        text: marcelicksText,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: { stability: 0.5, similarity_boost: 0.75 }
                    })
                });

                if (!audioResponse.ok) {
                    throw new Error("Erro ao gerar a voz. Até a ElevenLabs se cansou de você.");
                }

                const audioBlob = await audioResponse.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                new Audio(audioUrl).play();

            } catch (error) {
                responseDiv.innerText = `Erro: ${error.message}`;
                responseDiv.style.display = 'block';
            } finally {
                sendButton.disabled = false;
                sendButton.innerText = 'Enviar para o Mestre';
            }
        }
    </script>

</body>
</html>